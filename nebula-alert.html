<!--
@license
Copyright (c) 2017 Ars Nebula LLC.
This code may be used under the terms found in LICENSE.md of this repository.
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../nebula-style-attributes-behavior/nebula-style-attributes-behavior.html">
<link rel="import" href="../nebula-dialog/nebula-dialog.html">
<link rel="import" href="../nebula-appbar-layout/nebula-appbar-layout.html">
<link rel="import" href="../nebula-button/nebula-button.html">

<!--
`<nebula-alert>` is a web component to display an alert dialog.
  
## Usage

The following demonstrates the element with some common properties and events.

```html
<nebula-alert
  icon="icons:warning"
  title="Alert"
  text="You have been warned"
  buttons='["OK"]'
  value="{{alertValue}}>
</nebula-alert>
```

You can also create and show the element programatically. The `show` method will ensure the element is appended and removed from the `document.body` automatically. The method returns a promise that is resolved once the element closing animation is complete.

```js
// create the element
var alert = Polymer.Base.create('nebula-alert', {
  title: 'Alert',
  icon: 'warning',
  text: 'You have been warned',
  buttons: ['OK']
})

// show the element - automatically appended to document.body
alert.show().then(function(result) {
  console.log('The alert has been closed', result)
})
```

The `result` property wil return the index of the button clicked to close the dialog, or `undefined` if the dialog was cancelled by pressing the `ESC` key or clicking the backdrop. To disable cancel, set the `allowCancel` property to `false`.

## Style

The preferred approach to styling the element is using CSS custom properties and mixins.

Custom property | Description | Default
:--- | :--- | :---
`--nebula-alert-background-color` | The color of the dialog background. | black
`--nebula-alert-border-color` | The color of the dialog border. | transparent
`--nebula-alert-button-color` | The color of the buttons. | grey
`--nebula-alert-icon-color` | The color of the icon. | | white
`--nebula-alert-title-color` | The color of the title. | | white
`--nebula-alert-text-color` | The color of the text. | | white
`--nebula-alert` | Mixin applied to the host element.
`--nebula-alert-dialog` | Mixin applied to the dialog container.
`--nebula-alert-title` | Mixin applied to the title element.
`--nebula-alert-text` | Mixin applied to the text element.
`--nebula-alert-icon` | Mixin applied to the icon element.
`--nebula-alert-button` | Mixin applied to the button elements.

For convenience, you can also apply a theme to the element using the following style attributes:

- `backdrop-color`
- `border-color`
- `background-color`
- `icon-color`
- `button-color`
- `title-color`
- `text-color`

@demo demo/index.html
-->

<dom-module id="nebula-alert">
  <template>
    <style include="nebula-dialog-styles">
      :host {
        --nebula-alert-background-color: black;
        --nebula-alert-border-color: transparent;
        --nebula-alert-title-color: white;
        --nebula-alert-text-color: white;
        --nebula-alert-icon-color: white;
        --nebula-alert-button-color: grey;
        @apply --nebula-alert;
      }
      .dialog {
        position: relative;
        font-family: sans-serif;
        font-size: 1rem;
        width: 80%;
        height: auto;
        min-height: fit-content;
        overflow: hidden;
        max-width: 320px;
        cursor: default;
        margin: 64px 0;
        padding: 16px;
        background-color: var(--nebula-alert-background-color);
        border: 1px solid var(--nebula-alert-border-color);
        @apply --nebula-alert-dialog;
      }
      #icon {
        color: var(--nebula-alert-icon-color);
        left: 50%;
        transform: translateX(-50%);
        height: 32px;
        width: 32px;
        @apply --nebula-alert-icon;
      }
      #title {
        color: var(--nebula-alert-title-color);
        text-align: center;
        font-size: 1.2rem;
        font-weight: bold;
        @apply --nebula-alert-title;
      }
      #text {
        margin: 16px 0;
        color: var(--nebula-alert-text-color);
        text-align: center;
        @apply --nebula-alert-text;
      }
      .button {
        --nebula-button-color: var(--nebula-alert-button-color);
        display: block;
        margin-top: 8px;
        @apply --nebula-alert-button;
      }
    </style>
    <nebula-appbar-layout class="dialog">
      <div id="header" slot="header">
        <template is="dom-if" if="[[icon]]">
          <iron-icon id="icon" icon="[[icon]]"></iron-icon>
        </template>
        <template is="dom-if" if="[[title]]">
          <div id="title">[[title]]</div>
        </template>
      </div>
      <div id="content" slot="content">
        <template is="dom-if" if="[[text]]">
          <div id="text">[[text]]</div>
        </template>
      </div>
      <div id="footer" slot="footer">
        <template is="dom-repeat" items="[[buttons]]">
          <nebula-button
            class="button"
            data-index$="[[index]]"
            on-tap="_onButtonTap">
            {{item}}    
          </nebula-button>
        </template>
      </div>
    </nebula-appbar-layout>
  </template >
  <script>
    Polymer({
      is: 'nebula-alert',
      behaviors: [
        Nebula.StyleAttributesBehavior,
        Nebula.DialogBehavior
      ],      
      hostAttributes: {
        'role': 'alertdialog',
        'aria-labelledby': 'title',
        'aria-describedby': 'text'
      },
      /**
      * Map of style attributes that can be used to update CSS variables.
      */
      _styleAttributes: {
        'backdrop-color': '--nebula-dialog-backdrop-color',
        'title-color': '--nebula-alert-title-color',
        'text-color': '--nebula-alert-text-color',
        'background-color': '--nebula-alert-background-color',
        'border-color': '--nebula-alert-border-color',
        'button-color': '--nebula-alert-button-color',
        'icon-color': '--nebula-alert-icon-color'    
      },
      properties: {
        /**
        * The title to display.
        */
        title: {
          type: String
        },
        /**
        * The icon key to display as a spinner.
        */
        icon: {
          type: String
        },
        /**
        * The text message to display.
        */
        text: {
          type: String
        },
        /**
        * An array of buttons to generate.
        */
        buttons: {
          type: Array,
          value: function() {
            return ['OK']
          }
        }
      },
      /**
      * Event handler when a content button is tapped.
      * It sets the value property, and closes the element.
      */
      _onButtonTap: function(e) {
        e.preventDefault()
        e.stopPropagation()
        this.set('result', e.target.dataset.index)
        this.set('opened', false)
      }
    })
  </script>
</dom-module>