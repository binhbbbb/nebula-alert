<link rel="import" href="../shadycss/apply-shim.html">
<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../nebula-icons/nebula-icon.html">
<link rel="import" href="../nebula-dialog/nebula-dialog.html">
<link rel="import" href="../nebula-button/nebula-button.html">

<dom-module id="nebula-alert">
  <template>
    <style include="nebula-dialog-styles">
      :host {
        --nebula-dialog-backdrop-color: var(--nebula-alert-backdrop-color, var(--nebula-ui-backdrop-color, hsla(0, 0%, 0%, 0.6)));
        @apply --nebula-alert;
      }
      #dialog {
        width: 80%;
        max-width: 320px;
        height: auto;
        min-height: fit-content;
        cursor: default;
        align-items: stretch;
        margin: 64px 0;
        padding: 16px;
        text-align: center;
        background-color: var(--nebula-alert-dialog-background-color, transparent);
        border: 1px solid var(--nebula-alert-dialog-border-color, transparent);
        color: var(--nebula-alert-dialog-color, white);
        @apply --nebula-alert-dialog;
      }
      #icon {
        color: var(--nebula-alert-icon-color, currentColor);
        height: 32px;
        width: 32px;
        @apply --nebula-alert-icon;
      }
      #title {
        color: var(--nebula-alert-title-color, currentColor);
        text-align: center;
        font-size: 1.2rem;
        font-weight: bold;
        @apply --nebula-alert-title;
      }
      #text {
        margin: 16px 0;
        color: var(--nebula-alert-text-color, currentColor);
        text-align: center;
        @apply --nebula-alert-text;
      }
      .button {
        --nebula-button-color: var(--nebula-alert-button-color, currentColor);
        display: block;
        margin-top: 8px;
        @apply --nebula-alert-button;
      }
    </style>
    <div id="dialog">
      <dom-if if="[[icon]]">
        <template>
          <div id="icon-container">
            <nebula-icon id="icon" icon="[[icon]]"></nebula-icon>
          </div>
        </template>
      </dom-if>
      <dom-if if="[[title]]">
        <template>
          <div id="title">[[title]]</div>
        </template>
      </dom-if>
      <dom-if if="[[text]]">
        <template>
          <div id="text">[[text]]</div>
        </template>
      </dom-if>
      <dom-repeat items="[[buttons]]">
        <template>
          <nebula-button
            class="button"
            data-index$="[[index]]"
            on-click="__onButtonClick">
            {{item}}    
          </nebula-button>
        </template>
      </dom-repeat>
    </div>
  </template >
  <script>
  (function() {
    'use strict'

    /** A customizable alert dialog. */
    class NebulaAlert extends Nebula.DialogBehavior(Polymer.Element) {

      /** Gets the custom element name. */      
      static get is() { return 'nebula-alert' }

      /**
       * Gets the property definitions for data binding.
       * @type {Object}
       * @property {string} title - The title to display.
       * @property {string} icon - The key of the icon to display.
       * @property {number} text - A progress message.
       * @property {Array} buttons - An array of buttons to generate.
       */
      static get properties() {
        return {
          title: {
            type: String
          },
          icon: {
            type: String
          },
          text: {
            type: String
          },
          buttons: {
            type: Array,
            value: function() {
              return ['OK']
            }
          }
        }
      }

      /** Lifecycle callback invoked when element has been initialized. */
      ready() {
        super.ready()
        this.setAttribute('role', 'alertdialog')
        this.setAttribute('aria-labelledby', 'title')
        this.setAttribute('aria-describedby', 'text')
      }

      /** Event handler when a content button is tapped. */
      __onButtonClick(e) {
        e.preventDefault()
        e.stopPropagation()
        this.setProperties({
          result: e.target.dataset.index,
          opened: false
        })
      }

    }

    customElements.define(NebulaAlert.is, NebulaAlert)
  }())
  </script>
</dom-module>