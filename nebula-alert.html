<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../nebula-icons/nebula-icon.html">
<link rel="import" href="../nebula-dialog/nebula-dialog.html">
<link rel="import" href="../nebula-button/nebula-button.html">

<dom-module id="nebula-alert">
  <template>
    <style include="nebula-dialog-styles">
      :host {
        --nebula-dialog-backdrop-color: var(--nebula-alert-backdrop-color, var(--nebula-ui-backdrop-color, hsla(0, 0%, 0%, 0.6)));
      }
      #content {
        width: 80%;
        max-width: 320px;
        height: auto;
        min-height: fit-content;
        cursor: default;
        -webkit-align-items: stretch;
        align-items: stretch;
        margin: 64px 0;
        padding: 16px;
        text-align: center;
        background-color: var(--nebula-alert-background-color, transparent);
        border: 1px solid var(--nebula-alert-border-color, transparent);
        color: var(--nebula-alert-color, white);
      }
      #icon {
        color: var(--nebula-alert-icon-color, inherit);
        height: var(--nebula-alert-icon-size, 32px);
        width: var(--nebula-alert-icon-size, 32px);
      }
      #title {
        color: var(--nebula-alert-title-color, inherit);
        font: var(--nebula-alert-title-font, 1.2rem bold);
        text-align: center;
      }
      #text {
        color: var(--nebula-alert-text-color, inherit);
        font: var(--nebula-alert-text-font, inherit);
        text-align: center;
        margin: 16px 0;
      }
      #buttons {
        color: var(--nebula-alert-button-color, inherit);
        margin-top: 8px;
      }
    </style>
    <div id="content">
      <dom-if if="[[icon]]">
        <template>
          <div id="icon-container">
            <nebula-icon id="icon" icon="[[icon]]"></nebula-icon>
          </div>
        </template>
      </dom-if>
      <dom-if if="[[title]]">
        <template>
          <div id="title">[[title]]</div>
        </template>
      </dom-if>
      <dom-if if="[[text]]">
        <template>
          <div id="text">[[text]]</div>
        </template>
      </dom-if>
      <div id="buttons">
        <dom-repeat items="[[buttons]]">
          <template>
            <nebula-button
              class="button"
              data-index$="[[index]]"
              block>
              {{item}}    
            </nebula-button>
          </template>
        </dom-repeat>
      </div>
    </div>
  </template >
  <script>
  (function() {
    'use strict'

    // symbols for private members
    const onOpened = Symbol()
    const onClick = Symbol()

    // symbols for protected members
    const listen = Symbol.for('Nebula.ElementMixin.listen')

    /** A customizable alert dialog. */
    class NebulaAlert extends Nebula.DialogBehavior(Polymer.Element) {

      /** Gets the custom element name. */      
      static get is() { return 'nebula-alert' }

      /**
       * Gets the property definitions for data binding.
       * @type {Object}
       * @property {string} title - The title to display.
       * @property {string} icon - The key of the icon to display.
       * @property {number} text - A progress message.
       * @property {Array} buttons - An array of buttons to generate.
       */
      static get properties() {
        return {
          title: {
            type: String
          },
          icon: {
            type: String
          },
          text: {
            type: String
          },
          buttons: {
            type: Array,
            value: function() {
              return ['OK']
            }
          }
        }
      }

      /** Lifecycle callback invoked when element has been initialized. */
      ready() {
        super.ready()
        this.setAttribute('role', 'alertdialog')
        this.setAttribute('aria-labelledby', 'title')
        this.setAttribute('aria-describedby', 'text')
        this[listen](this, 'opened', this[onOpened])
        this[listen](this, 'click', this[onClick])
      }

      [onOpened](e) {
        const btn = this.shadowRoot.querySelector('.button')
        if (btn) {
          btn.focus()
        }
      }

      /** Event handler when a button is clicked. */
      [onClick](e) {
        const src = e.composedPath()[0]

        if (src.classList.contains('button')) {
          e.preventDefault()
          e.stopPropagation()

          this.setProperties({
            result: src.dataset.index,
            opened: false
          })
        }
      }

    }

    customElements.define(NebulaAlert.is, NebulaAlert)
  }())
  </script>
</dom-module>